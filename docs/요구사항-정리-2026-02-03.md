# 요구사항 정리 (2026-02-03)

## 핵심 요구사항
- Next.js(App Router), TypeScript, Mongoose(MongoDB)로 설문 SaaS 백엔드 설계.
- 저장은 실시간이 아닌 세션 종료 후 일괄 제출 방식.
- 설문 저장 구조는 Definition → Session → Response 3단계 분리.
- 질문 타입은 문자열로 저장하되 코드 레벨에서 표준 타입을 관리하고 CUSTOM을 허용.
- 동적 프롬프트 빌더로 질문 타입별 추출 규칙 생성.
- 거절 응답은 다음 질문으로 스킵, 종료 시 모델이 친절하게 마무리.

## 스키마 요구사항
### SurveyDefinition
- questions: [{ id, text, type, options, extractionGuide }]

### SurveySession
- respondentId
- transcript: [{ role, text, timestamp }]
- audioUrl
- createdAt

### SurveyResponse
- sessionId
- answers: Map<questionId, { value, originalText, reasoning }>

## 서비스 로직
- submitSurveyResult(data: { definitionId, transcript, audioUrl })
  1) SurveySession 저장
  2) SurveyDefinition 조회 및 프롬프트 생성
  3) LLM 분석 호출
  4) SurveyResponse 저장
